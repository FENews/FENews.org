{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"5c16f5e8-def0-5269-8cac-78f53dc3dc4b","excerpt":"è‡ªä»  React Hooks  å‘å¸ƒ alpha ç‰ˆæœ¬ä»¥æ¥, å°±æœ‰å¾ˆå¤šäººå¼€å§‹è®¨è®ºä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚: â€œä¸ºä»€ä¹ˆæœ‰äº› API ä¸æ˜¯ä¸€ä¸ª Hook?â€ã€‚ æ¯”å¦‚ä¸‹é¢è¿™äº›å°±æ˜¯ä¸€äº› Hooks APIï¼š  å¯ä»¥ç”¨æ¥å£°æ˜   å˜é‡ã€‚  å¯ä»¥ç”¨æ¥å£°æ˜  ã€‚  å¯ä»¥ç”¨æ¥è¯»å–  ã€‚ ä½†æ˜¯æœ‰äº› API å°±ä¸æ˜¯ hooksâ€¦","html":"<p>è‡ªä» <a href=\"https://reactjs.org/hooks\">React Hooks</a> å‘å¸ƒ alpha ç‰ˆæœ¬ä»¥æ¥, å°±æœ‰å¾ˆå¤šäººå¼€å§‹è®¨è®ºä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚: â€œä¸ºä»€ä¹ˆæœ‰äº› API ä¸æ˜¯ä¸€ä¸ª Hook?â€ã€‚</p>\n<p>æ¯”å¦‚ä¸‹é¢è¿™äº›å°±æ˜¯ä¸€äº› Hooks APIï¼š</p>\n<ul>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usestate\"><code class=\"language-text\">useState()</code></a> å¯ä»¥ç”¨æ¥å£°æ˜ <code class=\"language-text\">state</code> å˜é‡ã€‚</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\"><code class=\"language-text\">useEffect()</code></a> å¯ä»¥ç”¨æ¥å£°æ˜ <code class=\"language-text\">side effects</code>ã€‚</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usecontext\"><code class=\"language-text\">useContext()</code></a> å¯ä»¥ç”¨æ¥è¯»å– <code class=\"language-text\">context</code>ã€‚</li>\n</ul>\n<p>ä½†æ˜¯æœ‰äº› API å°±ä¸æ˜¯ hooksï¼Œæ¯”å¦‚ <code class=\"language-text\">React.memo()</code> å’Œ <code class=\"language-text\">&lt;Context.Provider&gt;</code>ã€‚ä¸€èˆ¬å¤§å®¶æå‡ºæ¥çš„å…³äº Hooks API çš„ææ¡ˆåŸºæœ¬ä¸Šæ˜¯<em>ä¸å¯ç»„åˆï¼ˆnoncompositionalï¼‰</em>å’Œ<em>åæ¨¡å—åŒ–ï¼ˆantimodularï¼‰</em>çš„ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆã€‚</p>\n<p><strong>æ³¨ï¼šè¿™ç¯‡æ–‡ç« æ˜¯ä¸€ç¯‡æ·±å…¥æ¢è®¨çš„æ–‡ç« ï¼Œé˜…è¯»å¯¹è±¡åº”è¯¥æ˜¯å¯¹ React API çš„è®¨è®ºæ˜¯éå¸¸æ„Ÿå…´è¶£çš„ï¼Œè€Œä¸æ˜¯ä¸ºäº†è€ƒè™‘ä½¿ç”¨ React æ¥æå‡æ•ˆç‡çš„ï¼</strong></p>\n<p>æˆ‘ä»¬æƒ³è®© React çš„ API ä¿æŒä»¥ä¸‹éå¸¸é‡è¦çš„ä¸¤ç‚¹:</p>\n<ol>\n<li>\n<p><strong>ç»„åˆ:</strong> å¯¹äº Hooks APIæ¥è¯´ï¼Œå¯ä»¥<a href=\"https://reactjs.org/docs/hooks-custom.html\">è‡ªå®šä¹‰ Hooks</a> æ˜¯è®©æˆ‘ä»¬æ„Ÿåˆ°éå¸¸å…´å¥‹çš„ã€‚ æˆ‘ä»¬æœŸæœ›å¤§å®¶éƒ½å¯ä»¥æ¥æ„å»ºè‡ªå·±çš„Hooks APIï¼Œ å¹¶ä¸”æˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸åŒäººå†™çš„ Hooks API <a href=\"https://overreacted.io/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem\">ä¸ä¼šé€ æˆå†²çª</a>ã€‚ (æˆ‘ä»¬æ˜¯ä¸æ˜¯å·²ç»è¢«éšæ„çš„ç»„åˆç»„ä»¶è€Œä¸ç”¨æ‹…å¿ƒç›¸äº’é€ æˆå½±å“ç»™æƒ¯åäº†ï¼Ÿ)</p>\n</li>\n<li>\n<p><strong>è°ƒè¯•:</strong> æˆ‘ä»¬å¸Œæœ›éšç€åº”ç”¨è§„æ¨¡çš„ä¸æ–­å¢é•¿ <a href=\"https://overreacted.io/the-bug-o-notation/\">bug æ˜¯å¾ˆå®¹æ˜“å‘ç°çš„</a>çš„ã€‚Reactæœ€æ£’çš„ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å¦‚æœæŸäº›å†…å®¹è¢«é”™è¯¯çš„æ¸²æŸ“äº†ï¼Œä½ å¯ä»¥è½»æ¾çš„å®šä½åˆ°å¯¹åº”ç»„ä»¶ä¸­çš„ prop æˆ–è€… state å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚</p>\n</li>\n</ol>\n<p>ç»“åˆè¿™ä¸¤ç‚¹æ¥çœ‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å“ªäº›å¯ä»¥æˆ–è€…<em>ä¸å¯ä»¥</em>æˆä¸ºä¸€ä¸ª Hookã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›ä¾‹å­æ¥è¯´æ˜ï¼š</p>\n<h2>ä¸€ä¸ª Hookï¼š<code class=\"language-text\">useState()</code></h2>\n<h3>ç»„åˆ</h3>\n<p>å¤šä¸ªè‡ªå®šä¹‰çš„ Hooks è°ƒç”¨ <code class=\"language-text\">useState()</code>ï¼Œè€Œä¸ä¼šé€ æˆå†²çªï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// What happens here, stays here.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// What happens here, stays here.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æ·»åŠ ä¸€ä¸ªä¸åœ¨æ¡ä»¶åˆ¤æ–­é‡Œçš„ <code class=\"language-text\">useState()</code> ï¼Œ è°ƒç”¨è¿™ä¸ª API æ˜¯å¾ˆå®‰å…¨çš„ã€‚ä½ ä¸éœ€è¦äº†è§£åœ¨ä¸€ä¸ªç»„ä»¶é‡Œé¢å£°æ˜äº†æ–°çš„ state å˜é‡è¢«å…¶ä»– Hooks ä½¿ç”¨äº†ã€‚ä¹Ÿä¸ä¼šå› ä¸ºæ›´æ–°äº†å…¶ä»–çŠ¶æ€å¯¼è‡´ state å˜é‡è¢«å½±å“ã€‚</p>\n<p><strong>ç»“è®º:</strong> âœ… <code class=\"language-text\">useState()</code> ä¸ä¼šå¯¹å…¶ä»–è‡ªå®šä¹‰çš„ Hooks é€ æˆå½±å“ã€‚ </p>\n<h3>è°ƒè¯•</h3>\n<p>Hooks æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä½ å¯ä»¥åœ¨ Hooks <em>ä¹‹é—´</em>ä¼ é€’å€¼ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Comment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isMobile <span class=\"token operator\">=</span> width <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MOBILE_VIEWPORT</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>section className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">.</span>comment<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä½†æ˜¯å¦‚è¿‡æˆ‘ä»¬çš„ä»£ç å‡ºé”™äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆè°ƒè¯•ï¼Ÿ</p>\n<p>å‡è®¾æˆ‘ä»¬ä» <code class=\"language-text\">theme.comment</code> é‡Œæ‹¿å‡ºæ¥çš„ä¸€ä¸ª css class æ˜¯é”™è¯¯çš„, é‚£æˆ‘ä»¬æ€ä¹ˆè°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶é‡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹æˆ–è€…è¾“å‡ºä¸€äº›æ—¥å¿—ã€‚</p>\n<p>ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å‘ç° <code class=\"language-text\">theme</code> æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯ <code class=\"language-text\">width</code> å’Œ <code class=\"language-text\">isMobile</code>æ˜¯æ­£ç¡®çš„ã€‚è¿™å°±å‘Šè¯‰æˆ‘ä»¬é—®é¢˜æ˜¯å‘ç”Ÿåœ¨ <code class=\"language-text\">useTheme()</code> é‡Œé¢ã€‚ä¹Ÿæœ‰å¯èƒ½ <code class=\"language-text\">width</code> ä¸å¯¹ï¼Œé‚£ä¹ˆç›¸åº”çš„é—®é¢˜å°±å‡ºåœ¨ <code class=\"language-text\">useWindowWidth()</code> é‡Œã€‚</p>\n<p><strong>ä¸€çœ‹æœ€é¡¶éƒ¨çš„å¯¹åº” Hooks é‡Œçš„ä¸­é—´å€¼å°±çŸ¥é“é—®é¢˜å‘ç”Ÿåœ¨å“ªé‡Œäº†ã€‚</strong> æˆ‘ä»¬ä¸éœ€è¦æŸ¥çœ‹ç»„ä»¶é‡Œæ‰€æœ‰çš„ Hooks çš„å®ç°ã€‚</p>\n<p>æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹æœ‰é—®é¢˜çš„é‚£ä¸ªå®ç°ï¼Œé‡å¤è¿™ä¸ªæ­¥éª¤å°±å¯ä»¥ç¡®å®šé—®é¢˜å…·ä½“é—®é¢˜å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ã€‚</p>\n<p>å¦‚æœè‡ªå®šä¹‰ Hooks çš„åµŒå¥—å±‚çº§å¢åŠ äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±å˜çš„æ›´åŠ é‡è¦ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸‰å±‚åµŒå¥—çš„è‡ªå®šä¹‰ Hookï¼Œæ¯å±‚ä½¿ç”¨äº†ä¸‰ä¸ªä¸åŒçš„è‡ªå®š Hooksã€‚ å®šä½<strong>3ä¸ªæœ‰é—®é¢˜çš„åœ°æ–¹</strong>å’Œå®šä½ <strong>3 + 3Ã—3 + 3Ã—3Ã—3 = 39ä¸ªæœ‰é—®é¢˜åœ°æ–¹</strong>ï¼ŒäºŒè€…ä¹‹é—´çš„æˆæœ¬<a href=\"https://overreacted.io/the-bug-o-notation/\">å·®åˆ«</a>æ˜¯éå¸¸å¤§çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code class=\"language-text\">useState()</code> ä¸ä¼šå¯¹å…¶ä»– Hooks æˆ–è€…ç»„ä»¶é€ æˆè«åå…¶å¦™çš„å½±å“ã€‚é›è¿‡ç•™ç—•ï¼Œä¸€ä¸ª Hooks è¿”å›çš„é”™è¯¯å€¼ï¼Œå’Œæ™®é€šçš„å˜é‡æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«çš„ã€‚ğŸ›</p>\n<p><strong>ç»“è®º:</strong> âœ… <code class=\"language-text\">useState()</code> ä¸ä¼šéšè—æˆ‘ä»¬ä»£ç ä¸­çš„å› æœå…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥ä¸€æ­¥æ­¥çš„å®šä½åˆ°å¯¹åº”çš„bugã€‚</p>\n<h2>ä¸æ˜¯ä¸€ä¸ª Hook: <code class=\"language-text\">useBailout()</code></h2>\n<p>ä½œä¸ºä¸€ç§ä¼˜åŒ–, ç»„ä»¶ä½¿ç”¨ Hooks å¯ä»¥é¿å…é‡æ–°æ¸²æŸ“ã€‚</p>\n<p>å¦ä¸€ç§æ–¹å¼æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href=\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo\"><code class=\"language-text\">React.memo()</code></a> åŒ…è£¹æ•´ä¸ªç»„ä»¶ã€‚ ä¸ºäº†é¿å…é‡æ–°æ¸²æŸ“ï¼Œ<code class=\"language-text\">React.memo()</code> ä¼šç”¨æœ¬æ¬¡å³å°†æ¸²æŸ“çš„ props å’Œæœ€åä¸€æ¬¡æ¸²æŸ“çš„ props é€šè¿‡ <code class=\"language-text\">shallowly equal</code> å»åšæ¯”è¾ƒï¼Œ è¿™ä¸ªå’Œ <code class=\"language-text\">PureComponent</code> æ˜¯ç±»ä¼¼çš„ã€‚</p>\n<p><code class=\"language-text\">React.memo()</code> æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»„ä»¶ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>Button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>ä½†æ˜¯ <code class=\"language-text\">useBailout()</code> ä¸ºä»€ä¹ˆä¸ä»…ä»…æ˜¯ä¸€ä¸ªé’©å­</strong></p>\n<p>ä¸è®ºä½ å°†å…¶ç§°ä¹‹ä¸º <code class=\"language-text\">useShouldComponentUpdate()</code>ï¼Œ <code class=\"language-text\">usePure()</code>ï¼Œ <code class=\"language-text\">useSkipRender()</code> æˆ–è€… <code class=\"language-text\">useBailout()</code>ï¼Œ è¿™ä¸ªææ¡ˆ(proposal)çœ‹èµ·æ¥å°±å’Œä¸‹é¢è¿™ä¸ªæ˜¯ä¸€æ ·çš„ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> color <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// âš ï¸ éçœŸå®API</span>\n  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span>prevColor <span class=\"token operator\">=></span> prevColor <span class=\"token operator\">!==</span> color<span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>button className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'button-'</span> <span class=\"token operator\">+</span> color<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>  \n      <span class=\"token constant\">OK</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¹Ÿæœ‰ä¸€äº›å…¶ä»–ä¸åŒçš„ææ¡ˆï¼ˆæ¯”å¦‚ï¼š<a href=\"https://github.com/reactjs/rfcs/pull/30#issuecomment-371337630\"><code class=\"language-text\">usePure()</code></a>ï¼‰ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªææ¡ˆä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p>\n<h3>ç»„åˆ</h3>\n<p>è®©æˆ‘ä»¬å°è¯•å°† <code class=\"language-text\">useBailout()</code> åœ¨ä¸¤ä¸ªè‡ªå®šä¹‰çš„ Hooks ä¸­ä½¿ç”¨ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOnline<span class=\"token punctuation\">,</span> setIsOnline<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// âš ï¸ éçœŸå®API</span>\n  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span>prevIsOnline <span class=\"token operator\">=></span> prevIsOnline <span class=\"token operator\">!==</span> isOnline<span class=\"token punctuation\">,</span> isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleStatusChange</span> <span class=\"token operator\">=</span> status <span class=\"token operator\">=></span> <span class=\"token function\">setIsOnline</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">.</span>isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> isOnline<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// âš ï¸ éçœŸå®API</span>\n  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span>prevWidth <span class=\"token operator\">=></span> prevWidth <span class=\"token operator\">!==</span> width<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleResize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWidth</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¦‚æœç°åœ¨åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰çš„ Hooks ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ChatLayout width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>FriendStatus isOnline<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'Typing...'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ChatLayout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“?</p>\n<p>å¦‚æœæ¯ä¸€ä¸ª <code class=\"language-text\">useBailout()</code> éƒ½æœ‰æƒé™å»è·³è¿‡æ›´æ–°ï¼Œé‚£ä¹ˆ <code class=\"language-text\">useWindowWidth()</code> é‡Œé¢çš„æ›´æ–°å°±ä¼šè¢« <code class=\"language-text\">useFriendStatus()</code> ç»™é˜»å¡ï¼Œåä¹‹äº¦ç„¶ã€‚ <strong>è¿™äº› Hooks ä¼šç›¸äº’å½±å“ã€‚</strong></p>\n<p>ç„¶è€Œï¼Œå¦‚æœå…è®¸<code class=\"language-text\">useBailout()</code> åœ¨ä¸€ä¸ªç»„ä»¶é‡Œå»é˜»æ­¢æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ <code class=\"language-text\">ChatThread</code> ç»„ä»¶é‡Œçš„ <code class=\"language-text\">isTyping</code> å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿæ— æ³•å»æ›´æ–°è¿™ä¸ªç»„ä»¶ã€‚</p>\n<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§è¯­ä¹‰ï¼Œ<strong>ä»»ä½•æ–°æ·»åŠ åˆ° <code class=\"language-text\">ChatThread</code> é‡Œçš„ Hooks å¦‚æœæ²¡æœ‰<em>åŒæ ·</em>è°ƒç”¨ <code class=\"language-text\">useBailout()</code>ï¼Œé‚£ä¹ˆè¿™äº› Hooks ä¹ŸåŒæ ·ä¼šè¢«é˜»æ–­</strong>ã€‚ä¸ç„¶ <code class=\"language-text\">useBailout()</code> ä¹Ÿæ²¡æœ‰åŠæ³•åœ¨ <code class=\"language-text\">useWindowWidth()</code> å’Œ <code class=\"language-text\">useFriendStatus()</code> é˜»æ­¢æ›´æ–°æ—¶ â€œæŠ•ä¸Šåå¯¹ç¥¨ï¼ˆvote againstï¼‰â€ã€‚</p>\n<p><strong>ç»“è®º:</strong> ğŸ”´ <code class=\"language-text\">useBailout()</code> è¿åäº†ç»„åˆåŸåˆ™ã€‚æ·»åŠ  <code class=\"language-text\">useBailout()</code> åˆ°ä¸€ä¸ª Hook é‡Œé¢å°±ä¼šå½±å“å…¶ä»– Hooks çš„çŠ¶æ€æ›´æ–°ã€‚æˆ‘å¸Œæœ› API æ˜¯<a href=\"https://overreacted.io/optimized-for-change/\">å¥å£®çš„(antifragile)</a>, ä½†æ˜¯ <code class=\"language-text\">useBailout()</code> çš„è¡Œä¸ºæ˜¯å®Œå®Œå…¨å…¨ç›¸åçš„ã€‚</p>\n<h3>è°ƒè¯•</h3>\n<p>åƒ <code class=\"language-text\">useBailout()</code> çš„è¿™æ ·çš„ hook ä¼šå¯¹è°ƒè¯•é€ æˆä»€ä¹ˆå½±å“ï¼Ÿ</p>\n<p>æˆ‘ä»¬ä½¿ç”¨åŒæ ·çš„åˆ—å­:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ChatLayout width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>FriendStatus isOnline<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'Typing...'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ChatLayout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å‡è®¾æœ‰äº›ä¸Šå±‚ç»„ä»¶çš„å±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯ <code class=\"language-text\">Typing...</code> label æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬é¢„æœŸæ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ—¶å€™æˆ‘ä»¬æ€ä¹ˆè°ƒè¯•å‘¢ï¼Ÿ</p>\n<p><strong>é€šå¸¸ï¼Œä½ ä¼šå¾ˆè‡ªä¿¡çš„å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦å»çœ‹<em>ä¸Šå±‚ç»„ä»¶</em>ã€‚</strong> å¦‚æœ <code class=\"language-text\">ChatThread</code> æ²¡æœ‰è·å¾— <code class=\"language-text\">isTyping</code> çš„æ–°å€¼ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€æ¸²æŸ“ <code class=\"language-text\">&lt;ChatThread isTyping={myVar} /&gt;</code> çš„ç»„ä»¶ï¼Œç„¶åå»æ£€æŸ¥ <code class=\"language-text\">myVar</code> ç­‰ç­‰ã€‚åœ¨åŒçº§ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ <code class=\"language-text\">shouldComponentUpdate()</code> ä¸­å‘ç°è¢«é˜»æ­¢äº†ï¼Œæˆ–è€… <code class=\"language-text\">isTyping</code> çš„å€¼æ²¡æœ‰æ­£ç¡®çš„ä¼ é€’è¿‡å»ã€‚æ£€æŸ¥åœ¨è¿™ä¸ªé“¾ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶é€šå¸¸ä¹Ÿèƒ½è½»æ¾çš„å®šä½åˆ°é—®é¢˜çš„æ ¹æºã€‚</p>\n<p>å¦‚æœ <code class=\"language-text\">useBailout()</code> Hook æ˜¯ä¸€ä¸ªçœŸå®çš„ APIã€‚åœ¨ä½ æ·±åº¦åœ°æ£€æŸ¥ <code class=\"language-text\">ChatThread</code> å’Œæ‰€æœ‰ç»„ä»¶<em>ä¸­ä½¿ç”¨åˆ°çš„æ¯ä¸€ä¸ªè‡ªå®šä¹‰ Hook</em> ä¹‹å‰ï¼Œä½ æ°¸è¿œä¸çŸ¥é“è·³è¿‡æ›´æ–°çš„åŸå› ã€‚ç”±äºæ¯ä¸€ä¸ªçˆ¶ç»„ä»¶<em>åŒæ ·</em>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ Hooksï¼Œè¿™ä¸ª<a href=\"https://overreacted.io/the-bug-o-notation/\">æƒ…å†µï¼ˆscalesï¼‰</a>å°±å˜çš„æ›´åŠ å¤æ‚äº†ã€‚</p>\n<p>è¿™å°±åƒä¸€ä¸ªæŠ½å±‰æŸœé‡Œæœ‰ä¸€å †å°æŠ½å±‰ï¼Œä½ éœ€è¦åœ¨å…¶ä¸­ä¸€ä¸ªæ‰¾åˆ°ä¸€æŠŠå°èºä¸åˆ€ä¸€æ ·ã€‚ä½ æ°¸è¿œä¸çŸ¥é“è¿™ä¸ªâ€œå‘â€åˆ°åº•æœ‰å¤šæ·±ã€‚</p>\n<p><strong>ç»“è®º:</strong> ğŸ”´ <code class=\"language-text\">useBailout()</code> Hook ä¸ä»…ä»…ç ´åå¯ç»„åˆæ€§, ä¸ºäº†æ‰¾åˆ°æœ‰ bug çš„é˜»æ­¢æ›´æ–°ä»£ç ï¼Œå¤§å¤§çš„å¢åŠ äº†è°ƒè¯•æ­¥éª¤å’Œè®¤çŸ¥è´Ÿè· â€”â€” åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æŒ‡æ•°çº§åˆ«çš„ã€‚</p>\n<p>æˆ‘ä»¬è®¨è®ºäº†ä¸€ä¸ªçœŸæ­£å­˜åœ¨çš„ Hook - <code class=\"language-text\">useState()</code>ï¼Œå’Œå¦ä¸€ä¸ªçœ‹ä¸Šå»æ˜¯ Hookï¼Œä½†æ˜¯å®é™…ä¸Š<em>ä¸</em>æ˜¯ä¸€ä¸ª Hook - <code class=\"language-text\">useBailout()</code> çš„ä¾‹å­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›ç»„åˆå’Œè°ƒè¯•åˆ—å­æ¯”è¾ƒäº†ä¸€ä¸‹ï¼Œå¹¶è®¨è®ºäº†ä¸ºä»€ä¹ˆå…¶ä¸­ä¸€ä¸ªæ˜¯æœ‰æ•ˆçš„ï¼Œå¦ä¸€ä¸ªæ˜¯æ— æ•ˆçš„ã€‚</p>\n<p>è™½ç„¶æ²¡æœ‰ â€œHook ç‰ˆæœ¬â€ çš„ <code class=\"language-text\">memo()</code> å’Œ <code class=\"language-text\">shouldComponentUpdate()</code>ï¼Œä½†æ˜¯Reactç¡®å®æä¾›äº†ä¸€ä¸ªå« <a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\"><code class=\"language-text\">useMemo()</code></a> çš„ API. è™½ç„¶æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œä½†æ˜¯ <code class=\"language-text\">useMemo()</code> æœ¬èº«çš„è¯­ä¹‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ä¼šé‡åˆ°ä¸Šé¢æ‰€è¯´çš„é—®é¢˜ã€‚</p>\n<p><code class=\"language-text\">useBailout()</code> åªæ˜¯ä¸€ä¸ªä¸ä¼šåƒ Hook ä¸€æ ·å·¥ä½œçš„ä¾‹å­ã€‚ä½†æ˜¯ä¹Ÿè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ Hooks API â€”â€” æ¯”å¦‚ï¼Œ<code class=\"language-text\">useProvider()</code>, <code class=\"language-text\">useCatch()</code>, å’Œ <code class=\"language-text\">useSuspense()</code>ã€‚</p>\n<p>ç°åœ¨æ˜ç™½ä¸ºä»€ä¹ˆäº†å—?</p>\n<p><em>(ä½å¤´å˜€å’•: ç»„åˆâ€¦ è°ƒè¯•â€¦)</em></p>\n<p>åŸæ–‡åœ°å€ï¼š<a href=\"https://overreacted.io/why-isnt-x-a-hook/\">https://overreacted.io/why-isnt-x-a-hook/</a></p>","frontmatter":{"title":"ã€Œè¯‘ã€ä¸ºä»€ä¹ˆ 'XX' ä¸æ˜¯ä¸€ä¸ª Hooks API?","date":"January 30, 2019","description":"æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œä½†å¹¶ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬åº”è¯¥è¿™æ ·åšã€‚"}}},"pageContext":{"slug":"/2019-01-30---why-x-is-not-a-hook/","previous":{"fields":{"slug":"/2019-01-24---the-Orinoco-garbage-collector/"},"frontmatter":{"title":"ã€Œè¯‘ã€Orinoco: V8çš„åƒåœ¾å›æ”¶å™¨"}},"next":{"fields":{"slug":"/2019-01-31---javascript-performance-test/"},"frontmatter":{"title":"ã€Œè¯‘ã€JavaScript æ€§èƒ½æµ‹è¯•- æ¯”è¾ƒ for/ forEach/ map/ reduce/ filter/ find"}}}}